# APT

## 概念界定

APT（Advanced Persistent Threat）[高级持续性威胁] 是一种极其隐蔽、针对性强且长期潜伏的网络攻击形式。与普通的广撒网式黑客攻击不同，APT 攻击通常由具备国家背景、资金充足且高度组织化的黑客组织发起，其目的往往是为了窃取核心机密数据、进行政治间谍活动或破坏关键基础设施。

可以从其缩写拆解来深刻理解：

- **A (Advanced / 高级)**：攻击者掌握高级的攻击技术，经常使用 0day 漏洞、定制化的恶意软件、复杂的免杀技术以及“离地攻击”（Living off the Land, LotL）策略。
  
- **P (Persistent / 持续性)**：攻击不是一蹴而就的。攻击者在建立初始据点后，会极力隐藏行踪，进行长达数月甚至数年的潜伏，不断进行横向移动以获取更高权限。
  
- **T (Threat / 威胁)**：攻击者是具有明确目标、高动机和强破坏力的人类实体，而非自动化的蠕虫或普通的勒索软件。
  

## APT 攻击生命周期 (Kill Chain 视角)

APT 攻击通常遵循严密的战术步骤，以下结合洛克希德·马丁的 Cyber Kill Chain 及 MITRE ATT&CK 框架进行梳理：

### 阶段一：情报收集与侦察 (Reconnaissance)

攻击者通过 OSINT（开源情报）收集目标企业的组织架构、员工信息、使用的 IT 架构及安全防护机制。

- **常见手段**：社交媒体挖掘、企业公开文档分析、外网资产探测与指纹识别。

### 阶段二：武器构建与投递 (Weaponization & Delivery)

将恶意代码与载体结合，并通过特定渠道送达目标。

- **常见手段**：
  
  - **鱼叉式网络钓鱼 (Spear Phishing)**：发送极具迷惑性的带有恶意附件或链接的邮件。
    
  - **水坑攻击 (Watering Hole)**：攻陷目标群体经常访问的合法网站，植入恶意脚本。
    
  - **供应链攻击 (Supply Chain Attack)**：在目标使用的第三方软件或硬件供应商处植入后门。
    

### 阶段三：突防与据点建立 (Exploitation & Installation)

利用漏洞或社会工程学诱使受害者执行恶意代码，并在目标机器上安装后门，确保重启后依然存活。

- **常见手段**：利用 N-day 或 0-day 漏洞、注册表劫持、计划任务植入、Rootkit/Bootkit。

### 阶段四：C2 通信与控制 (Command and Control)

受控主机与攻击者的 C2 服务器建立隐蔽连接，接收指令。

- **常见手段**：使用 DGA（动态域名生成算法）、DNS 隧道、ICMP 隧道，或将流量伪装成正常的 HTTPS/TLS 流量（如通过 CDN 域前置技术）。

### 阶段五：横向移动与提权 (Lateral Movement & Privilege Escalation)

以初始感染机器为跳板，在内网中探测核心资产，并设法获取域控或高级管理员权限。

- **常见手段**：凭据窃取（如 Mimikatz 提取 Hash）、哈希传递 (PtH)、票据传递 (PtT)、利用内网弱口令或 RCE 漏洞。

### 阶段六：目标达成 (Action on Objectives)

完成最终的攻击目的，通常是数据窃取或破坏。

- **常见手段**：数据打包加密、分块传输、通过隐蔽隧道将核心数据外发（Exfiltration），或者投放勒索软件/擦除器（Wiper）破坏系统以掩盖痕迹。

## SOC 监控与防御响应策略

针对 APT 攻击的隐蔽性，传统的基于签名匹配的防病毒软件和防火墙往往失效，需要构建纵深防御体系：

1. **威胁情报驱动 (Threat Intelligence)**
  
  - 接入高质量的 IOCs（IP、域名、文件 Hash）和 TTPs（战术、技术和过程）情报，在 SIEM 系统中进行实时碰撞比对。
2. **全流量与行为分析 (NDR & UEBA)**
  
  - **NDR (网络检测与响应)**：监控东西向与南北向异常流量，识别隐蔽隧道、DGA 域名请求及异常的大量数据外传。
    
  - **UEBA (用户与实体行为分析)**：建立用户和主机的正常行为基线，对异常登录时间、异常位置访问、异常权限提升和横向移动进行告警。
    
3. **端点深度可见性 (EDR/XDR)**
  
  - 部署 EDR 监控进程创建、注册表修改、内存注入、PowerShell 异常执行等底层行为，防范“无文件攻击”和 LotL 战术。
4. **主动威胁狩猎 (Threat Hunting)**
  
  - 不要被动等待告警。安全运营人员需基于假设（如：假设内网已有主机被控），主动在日志数据湖中检索潜在的攻击痕迹。